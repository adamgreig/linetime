# Firmware Outline/To-Do

* GPS set-up:
    * Disable NMEA messages
    * Configure for timing mode
    * Generate some TIMEPULSE1 freq (16MHz? some even multiple of 48MHz?)
    * Generaet 1PPS TIMEPULSE2
    * Other settings (static location, antenna power, UTC aligned PPS, etc)
    * Request/parse UTC time information

* System clock set-up:
    * Program CS2100 to generate 10MHz or 26MHz reference
    * Enable HSE, wait HSE RDY
    * Swap SW to HSI
    * Disable PLL
    * Swap PLL src to HSE
    * Reconfigure PLL M value to HSE/2
    * Enable PLL, wait PLL RDY
    * Swap SW to PLL

* Mains:
    * Set up TIM2 for fast operation, timestamp CH1 and CH2 edges
    * Set up ADC1 for constantly measuring MAINS_WAVE
    * Set up ADC2 for occasional measurements of MAINS_BIAS
    * Compute mains ZC timestamp, frequency, RMS

* Ethernet:
    * Read MAC address from ROM
    * LWIP to send TCP (or UDP?) packets

* MicroSD:
    * Read/write packet buffer to SD card
    * Or store in RAM until we run out of buffer room, then save buffers

* Battery:
    * ADC3 to monitor charge current and battery voltage
    * Cycle CE as required

* LCD:
    * Worry about this later
    * Backlight PWM
    * SPI config/initialisation
    * TFT LCD peripheral

* Touch screen controller:
    * Worry about this later
    * SPI streaming touch events

* Sounder:
    * Worry about this later
    * DAC to amp
