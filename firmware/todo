# Firmware Outline/To-Do

x * GPS set-up:
x    * Disable NMEA messages
x    * Configure for timing mode
x    * Generate some TIMEPULSE1 freq (1MHz? some even multiple of 48MHz?)
x    * Generaet 1PPS TIMEPULSE2
x    * Other settings (static location, antenna power, UTC aligned PPS, etc)
x    * Request/parse UTC time information

* System clock set-up:
x    * Program CS2100 to generate 26MHz reference
x    * Enable HSE, wait HSE RDY
x    * Swap SW to HSI
x    * Disable PLL
x    * Swap PLL src to HSE
x    * Reconfigure PLL M value to HSE/2 = 13
x    * Enable PLL, wait PLL RDY
x    * Swap SW to PLL

* Mains:
    * Set up TIM2 for fast operation, timestamp CH1 and CH2 edges
    * Set up ADC1 for constantly measuring MAINS_WAVE
    * Set up ADC2 for occasional measurements of MAINS_BIAS
    * Compute mains ZC timestamp, frequency, RMS

* Ethernet:
    * Read MAC address from ROM
    * LWIP to send TCP (or UDP?) packets

* MicroSD:
    * Read/write packet buffer to SD card
    * Or store in RAM until we run out of buffer room, then save buffers

* Battery:
    * ADC3 to monitor charge current and battery voltage
    * Cycle CE as required

* LCD:
    * Worry about this later
    * Backlight PWM
    * SPI config/initialisation
    * TFT LCD peripheral

* Touch screen controller:
    * Worry about this later
    * SPI streaming touch events

* Sounder:
    * Worry about this later
    * DAC to amp
